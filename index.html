<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Thêm viewport để tối ưu hóa di động -->
    <title>越南语听力练习</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            text-align: center; 
            margin: 0; 
            padding-bottom: 300px; /* Mặc định cho màn hình lớn */
            background-color: #f7fbf3; /*f7fbf3  3f4040*/
        }
        #gameContainer {
            display: block;
            min-height: calc(100vh - 150px); /* Đảm bảo nội dung chiếm đủ chiều cao màn hình */
        }
        #infoBox { 
            width: 95%; 
            max-width: 700px;
            min-height: 100px; 
            margin: 0 auto; 
            border: 2px solid #91b66f; /*041b31 1f4263*/
            background: #85ae5f; /*ecf2e4 fefefc*/
            color: #ffffff; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: clamp(40px, 5vw, 30px);
            font-weight: bold;
        }
        #contactBox { 
            width: 90%; 
            max-width: 700px;
            min-height: 25px; 
            margin: 0px auto; 
            border: 2px solid #91b66f; 
            background: #85ae5f; 
            color: #f1c232; 
            display: flex; 
            align-items: center; 
            justify-content: left; 
            padding-left: 20px;
            font-size: clamp(16px, 2vw, 18px); 
            font-weight: bold;
        }
        #instructionBox { 
            width: 90%; 
            max-width: 700px;
            min-height: 25px; 
            margin: 0px auto; 
            border: 2px solid #91b66f; 
            background: #85ae5f; 
            color: #f7e19c; 
            display: flex; 
            align-items: center; 
            justify-content: left; 
            padding-left: 20px;
            font-size: clamp(16px, 2vw, 18px); 
            font-weight: bold;
        }
        #controls { 
            position: fixed; /* Cố định ở cuối màn hình */
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            max-width: 800px; /* Giới hạn chiều rộng tối đa */
            background: #f7fbf3;
                        border: 3px solid   #f7fbf3;                        
            padding: 10px 0; 
           /* box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2); */
            z-index: 1000; 
        }
        #controls div {
            margin: 5px 0; 
            display: flex;
            justify-content: center;
            align-items: center;
        }
        button { 
            padding: 5px 5px; 
            margin: 0 5px; 
            cursor: pointer; 
            border: 2px solid #85ae5f; 
            background: #85ae5f; /*192332*/
                        box-shadow: 0 5px 5px rgba(0, 0, 0, 0.2);
            color: #fffbef; 
            font-size: 18px; 
            border-radius: 5px; 
        }
        #sentenceNumber { 
            width: 50px; 
            padding: 10px; 
            text-align: center; 
            border: 3px solid #85ae5f; /*041b31 68838B*/
            background: #f1cc76; 
            color: #000; 
            border-radius: 10px; 
            font-size: 16px; 
            -moz-appearance: textfield; 
        }
        #sentenceNumber::-webkit-inner-spin-button, 
        #sentenceNumber::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        #sentenceNumber:disabled { 
            background: #eee; 
        }
        .disabled { 
            cursor: not-allowed; 
            pointer-events: none; 
        }
        .active-mode { 
            border: 2px solid #fed16a; 
        }
        #indicator { 
            width: 95%;
                        max-width: 700px; 
            min-height: 30px; 
            margin: 10px auto; 
                        padding: 5px;
            border: 3px solid #fed16a; 
            background: #ffffe0; 
            border-radius: 10px; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
        }
        #optionsContainer {
            width: 100%;
            max-width: 700px;
            margin: 10px auto;
        }
        .optionBtn {
            width: 95%; 
            max-width: 700px;
            padding: 10px;
            margin: 5px 0;
            border: 2px solid #ffffff;
            background: #ffffff; /*E6EDD9*/
            color: #000000;
                        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            font-size: 25px;
            text-align: left;
            cursor: pointer;
            border-radius: 5px;
        }
        .optionBtn:hover {
            background: #D2E4C4;
        }
        .correct {
            background: #B7D7AA !important;
        }
        .wrong {
            background: #CE6D5E !important;
        }
        #score { 
            display: none; 
            width: 100%;
            max-width: 700px;
            margin: 10px auto; 
            color: #FF6820; 
            font-size: 30px; 
            text-align: center;
        }
        #wrongSentences { 
            display: none; 
            width: 95%; 
            max-width: 700px; 
            margin: 10px auto; 
            padding: 10px; 
            border: 2px solid #CE6D5E; 
            background: #FFF0F0; 
            color: #CE6D5E; 
            font-size: 30px; 
            text-align: left; 
            border-radius: 5px; 
        }
        #results { 
            display: none; 
            width: 95%;
            max-width: 700px;        
            margin: 10px auto; 
            padding: 10px; 
            border: 2px solid #734A2E; 
            background: #fffbef; 
            color: #000; 
            font-size: 30px; 
            text-align: left; 
            border-radius: 5px; 
            white-space: pre-line;
        }

        /* Media query cho thiết bị di động */
        @media (max-width: 768px) {
            body {
                padding-bottom: 200px; /* Giảm padding-bottom cho điện thoại */
            }
            #controls {
                padding: 5px 0; /* Giảm padding */
            }
            button {
                padding: 6px 6px; /* Giảm kích thước nút */
                font-size: 20px; /* Giảm kích thước chữ */
            }
            #sentenceNumber {
                width: 40px; /* Giảm chiều rộng */
                padding: 8px; /* Giảm padding */
                font-size: 14px; /* Giảm kích thước chữ */
            }
            .optionBtn {
                font-size: 20px; /* Giảm kích thước chữ cho đáp án */
                padding: 8px; /* Giảm padding */
            }
            #infoBox {
                font-size: clamp(30px, 4vw, 40px); /* Giảm kích thước chữ */
            }
            #contactBox, #instructionBox {
                font-size: clamp(14px, 2vw, 16px); /* Giảm kích thước chữ */
            }
            #indicator {
                min-height: 40px; /* Giảm chiều cao tối thiểu */
            }
            #results, #wrongSentences, #score {
                font-size: 24px; /* Giảm kích thước chữ */
                                width: 90%;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="infoBox">习得越南语<br>听力练习</div>
        <div id="contactBox">讲师-阮玉煌 | Weixin：XiDeYueNanYu</div>
        <div id="instructionBox">选择与播放内容相符的选项</div>
        <div id="indicator"></div>
        <div id="optionsContainer"></div>
        <div id="results"></div>
        <div id="score">0/0</div>
        <div id="wrongSentences"></div>
    </div>
    <div id="controls">
        <div>
            <button id="freeModeBtn" class="active-mode">自由模式</button>
            <button id="testModeBtn">作业模式</button>
        </div>
        <div>
            <button id="autoContinueBtn">自动继续</button>
            <button id="showHideBtn">显示-隐藏</button>
        </div>
        <div>
            <button id="prevBtn">◀</button>
            <input type="text" id="sentenceNumber" inputmode="numeric" pattern="[0-9]*">
            <button id="nextBtn">▶</button>
            <button id="replayBtn">再听一遍</button>
        </div>
    </div>
    <audio id="mainAudio" src="audio.mp3"></audio>
    <audio id="correctAudio" src="Dung.mp3"></audio>
    <audio id="wrongAudio" src="Sai.mp3"></audio>

    <script>
        const audio = document.getElementById('mainAudio');
        const correctAudio = document.getElementById('correctAudio');
        const wrongAudio = document.getElementById('wrongAudio');
        const indicator = document.getElementById('indicator');
        const sentenceNumber = document.getElementById('sentenceNumber');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const replayBtn = document.getElementById('replayBtn');
        const freeModeBtn = document.getElementById('freeModeBtn');
        const testModeBtn = document.getElementById('testModeBtn');
        const autoContinueBtn = document.getElementById('autoContinueBtn');
        const showHideBtn = document.getElementById('showHideBtn');
        const scoreDisplay = document.getElementById('score');
        const wrongSentencesDisplay = document.getElementById('wrongSentences');
        const optionsContainer = document.getElementById('optionsContainer');
        const resultsDisplay = document.getElementById('results');

        const buttons = [prevBtn, nextBtn, replayBtn, freeModeBtn, testModeBtn, autoContinueBtn, showHideBtn];

const sentences = [
    {
        "audioFile": "audio.mp3",
        "start": 0.161833,
        "end": 2.701833,
        "correctAnswer": "Con thích quyển sách nào thì mua quyển sách ấy.",
        "translation": "你喜欢哪本书就买哪本书。",
        "options": [
            "Con thích quyển sách nào thì mua quyển sách ấy.",
            "Con thích quyển sách nào thì mưa quyển sách ấy.",
            "Con thít quyển sách nào thì mua quyển sách ấy.",
            "Con thích quyển sách nào thì mua quyển sánh ấy."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 3.171833,
        "end": 5.851833,
        "correctAnswer": "Trường nào tốt thì chúng ta đăng ký học trường ấy.",
        "translation": "哪所学校好，我们就报名哪所学校。",
        "options": [
            "Trường nào tốt thì chúng ta đăng ký học trường ấy.",
            "Trường nào tốt thì chúng ta đăng ký học trường ẩy.",
            "Trường nào tột thì chúng ta đăng ký học trường ấy.",
            "Trường nào tốt thì chúng ta đăng ký học trương ấy."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 6.381833,
        "end": 10.301833,
        "correctAnswer": "Thời gian không đủ, bài nào khó thì cô sẽ giải thích bài ấy.",
        "translation": "时间不够，哪道题难老师就讲哪道题。",
        "options": [
            "Thời gian không đủ, bài nào khó thì cô sẽ giải thích bài ấy.",
            "Thời gian không đủ, bài nào khó thì cô sẽ giải thích bài ẩy.",
            "Thời gian không đủ, bài nào khó thì cô sẽ giãi thích bài ấy.",
            "Thời gian không đủ, bày nào khó thì cô sẽ giải thích bài ấy."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 10.831833,
        "end": 13.431833,
        "correctAnswer": "Người nào đến trước thì phục vụ người ấy trước.",
        "translation": "谁先来就先为谁服务。",
        "options": [
            "Người nào đến trước thì phục vụ người ấy trước.",
            "Người nào đến trước thì phục vụ người ẩy trước.",
            "Người nào đên trước thì phục vụ người ấy trước.",
            "Người nào đến trước thì phục vụ người ấy trướt."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 13.811833,
        "end": 17.691833,
        "correctAnswer": "Em chọn đi! Chiếc áo nào vừa thì chúng ta mua chiếc áo ấy.",
        "translation": "你挑吧！哪件衣服合适我们就买哪件。",
        "options": [
            "Em chọn đi! Chiếc áo nào vừa thì chúng ta mua chiếc áo ấy.",
            "Em chọn đi! Chiếc áo nào vừa thì chúng ta mua chiếc áo ẩy.",
            "Em chọn đi! Chiếc áo nào vừa thì chúng ta mua chiếc ào ấy.",
            "Em chọn đi! Chiếc áo nào vừa thì chúng ta múa chiếc áo ấy."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 18.221833,
        "end": 21.901833,
        "correctAnswer": "Ở Việt Nam có rất nhiều hoa quả, mùa nào thức ấy.",
        "translation": "在越南水果很多，什么季节有什么水果。",
        "options": [
            "Ở Việt Nam có rất nhiều hoa quả, mùa nào thức ấy.",
            "Ở Việt Nam có rất nhiều hoa quả, mùa nào thước ấy.",
            "Ở Việt Nam có rất nhiều hoa quả, mùa nào thức ẩy.",
            "Ở Việt Nam có rất nhiều hoả quả, mùa nào thức ấy."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 22.521833,
        "end": 26.541833,
        "correctAnswer": "Lên kế hoạch xong, chúng tôi làm việc ngay, người nào việc ấy.",
        "translation": "计划好后我们立刻开始工作，各自做各自的。",
        "options": [
            "Lên kế hoạch xong, chúng tôi làm việc ngay, người nào việc ấy.",
            "Lên kế hoạch xong, chúng tôi làm việt ngay, người nào việc ấy.",
            "Lên kế hoạch xong, chúng tôi làm việc ngay, người nào việt ấy.",
            "Lên kế hoạch xong, chúng tôi làm việc ngay, người nào việc ẩy."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 27.071833,
        "end": 29.071833,
        "correctAnswer": "Tôi về nhà ngay sau khi tan học.",
        "translation": "放学后我立刻回家。",
        "options": [
            "Tôi về nhà ngay sau khi tan học.",
            "Tôi về nhà ngay sau khi tàn học.",
            "Tôi về nha ngay sau khi tan học.",
            "Tôi về nhà ngay sau khi tan hộc."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 29.481833,
        "end": 32.261833,
        "correctAnswer": "Anh ấy trả lời email ngay trong buổi sáng.",
        "translation": "他一早就回复了邮件。",
        "options": [
            "Anh ấy trả lời email ngay trong buổi sáng.",
            "Anh ấy trả lời email ngay trong buổi sang.",
            "Anh ấy trả lời emeo ngay trong buổi sáng.",
            "Anh ấy trả lời email ngay trong bủi sáng."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 32.801833,
        "end": 35.431833,
        "correctAnswer": "Chúng tôi bắt đầu cuộc họp ngay khi mọi người đến.",
        "translation": "人一到，我们就立刻开会。",
        "options": [
            "Chúng tôi bắt đầu cuộc họp ngay khi mọi người đến.",
            "Chúng tôi bắt đầu cuộc họp ngay khi mội người đến.",
            "Chúng tôi bắt đầu cuốc họp ngay khi mọi người đến.",
            "Chúng tôi bắt đầu cuộc họp ngay khi mọi người đễn."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 35.941833,
        "end": 38.501833,
        "correctAnswer": "Cô giáo cho điểm ngay sau khi kiểm tra xong.",
        "translation": "老师在考试结束后立刻打分。",
        "options": [
            "Cô giáo cho điểm ngay sau khi kiểm tra xong.",
            "Cô giáo cho điểm ngay sau khi kiểm trà xong.",
            "Cô giáo cho điểm ngay sau khi kiểm tra xon.",
            "Cô giáo cho điểm ngay sau khi kiễm tra xong."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 39.061833,
        "end": 41.671833,
        "correctAnswer": "Con chọn món ăn đi, món nào cũng được.",
        "translation": "你挑个菜吧，哪个都行。",
        "options": [
            "Con chọn món ăn đi, món nào cũng được.",
            "Con chọn món ăn đi, món nào củng được.",
            "Con chọn món ăn đi, mốn nào cũng được.",
            "Con chọn món ăn đi, món nào cũng đuọc."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 42.181833,
        "end": 47.151833,
        "correctAnswer": "Tớ có 3 vé xem phim, cậu rủ thêm một người nữa đi cùng nhé, ai cũng được.",
        "translation": "我有三张电影票，你再叫一个人一起去吧，谁都可以。",
        "options": [
            "Tớ có 3 vé xem phim, cậu rủ thêm một người nữa đi cùng nhé, ai cũng được.",
            "Tớ có 3 vé xem phim, cậu rủ thêm một người nữa đi cùng nhé, ai củng được.",
            "Tớ có 3 vé xem phim, cậu rủ thêm một người nữa đi cùng nhé, ai cũng đuợc.",
            "Tớ có 3 vé xem phim, cậu rủ thêm một người nữa đi cùng nhé, ai củng đuợc."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 47.681833,
        "end": 50.421833,
        "correctAnswer": "Tớ đang ở nhà, lúc nào cậu đến cũng được.",
        "translation": "我在家，什么时候来都可以。",
        "options": [
            "Tớ đang ở nhà, lúc nào cậu đến cũng được.",
            "Tớ đang ở nhà, lúc nào cậu đến củng được.",
            "Tớ đang ở nhà, lúc nào cậu đến cũng đuợc.",
            "Tớ đang ở nhà, lúc nào cậu đến cũng đén."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 50.831833,
        "end": 53.511833,
        "correctAnswer": "Anh chọn nhà hàng đi, chỗ nào cũng được.",
        "translation": "你选一家餐厅吧，哪家都行。",
        "options": [
            "Anh chọn nhà hàng đi, chỗ nào cũng được.",
            "Anh chọn nhà hàng đi, chỗ nào củng được.",
            "Anh chọn nhà hàng đi, chỗ nào cũng đuợc.",
            "Anh chọn nhà hàng đi, chổ nào cũng được."
        ]
    }
];

        let currentIndex = 0;
        let isFreeMode = true;
        let correctCount = 0;
        let isPlaying = false;
        let correctSentences = new Set();
        let wrongSentences = new Set();
        let autoContinue = false;
        let showAnswer = false;
        let userAnswers = [];

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function init() {
            updateSentenceDisplay();
        }

        function updateSentenceDisplay() {
            sentenceNumber.value = currentIndex + 1;
            indicator.style.background = '#ffffe0';
            if (isFreeMode && showAnswer) {
                indicator.innerHTML = `
                    <div style="font-size: 18px; font-weight: bold; color: #85ae5f;">${sentences[currentIndex].translation}</div>
                `;
            } else {
                indicator.innerHTML = '';
            }
            updateOptions();
            if (!isFreeMode) updateScore();
        }

        function updateOptions() {
            optionsContainer.innerHTML = '';
            const shuffledOptions = shuffleArray(sentences[currentIndex].options);
            shuffledOptions.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'optionBtn';
                btn.textContent = option;
                btn.onclick = () => checkAnswer(option);
                optionsContainer.appendChild(btn);
            });
        }

        function playCurrentSentence() {
            if (isPlaying) audio.pause();
            buttons.forEach(btn => btn.classList.add('disabled'));
            sentenceNumber.disabled = true;
            isPlaying = true;
            audio.src = sentences[currentIndex].audioFile;
            audio.currentTime = sentences[currentIndex].start;
            audio.play().catch(error => {
                console.error('Audio playback failed:', error);
                alert('Vui lòng nhấn nút “再听一遍” để phát âm thanh.');
                buttons.forEach(btn => btn.classList.remove('disabled'));
                sentenceNumber.disabled = false;
                isPlaying = false;
            });

            audio.ontimeupdate = () => {
                if (audio.currentTime >= sentences[currentIndex].end) {
                    audio.pause();
                    audio.ontimeupdate = null;
                    buttons.forEach(btn => btn.classList.remove('disabled'));
                    sentenceNumber.disabled = false;
                    isPlaying = false;
                }
            };
        }

        function moveSentence(direction) {
            currentIndex = (currentIndex + direction + sentences.length) % sentences.length;
            updateSentenceDisplay();
            playCurrentSentence();
        }

        function checkAnswer(selectedAnswer) {
            const correctAnswer = sentences[currentIndex].correctAnswer;
            const optionButtons = optionsContainer.getElementsByClassName('optionBtn');
            
            // Clear previous styles
            for (let btn of optionButtons) {
                btn.classList.remove('correct', 'wrong');
                btn.disabled = !isFreeMode; // Only disable buttons in Test Mode
            }

            // Find and style the selected button
            for (let btn of optionButtons) {
                if (btn.textContent === selectedAnswer) {
                    if (selectedAnswer === correctAnswer) {
                        indicator.style.background = '#B7D7AA';
                                                indicator.innerHTML = `
                    <div style="font-size: 18px; font-weight: bold; color: #000000;">${sentences[currentIndex].translation}</div>
                `;
                        btn.classList.add('correct');
                        correctAudio.play().catch(error => {
                            console.error('Correct audio playback failed:', error);
                        });
                    } else {
                        indicator.style.background = '#CE6D5E';
                                                indicator.innerHTML = `
                    <div style="font-size: 18px; font-weight: bold; color: #000000;">${sentences[currentIndex].translation}</div>
                `;
                        btn.classList.add('wrong');
                        wrongAudio.play().catch(error => {
                            console.error('Wrong audio playback failed:', error);
                        });
                    }
                }
            }

            if (!isFreeMode) {
                userAnswers[currentIndex] = selectedAnswer;
                if (selectedAnswer === correctAnswer && !correctSentences.has(currentIndex)) {
                    correctCount++;
                    correctSentences.add(currentIndex);
                    wrongSentences.delete(currentIndex);
                } else if (selectedAnswer !== correctAnswer && !correctSentences.has(currentIndex)) {
                    wrongSentences.add(currentIndex);
                }
                updateScore();

                // Auto-move to next sentence in Test Mode
                const audioToWait = (selectedAnswer === correctAnswer) ? correctAudio : wrongAudio;
                audioToWait.onended = () => {
                    if (userAnswers.length === sentences.length) {
                        showResults();
                    } else {
                        setTimeout(() => {
                            moveSentence(1);
                        }, 200);
                    }
                };
            } else if (isFreeMode && autoContinue && selectedAnswer === correctAnswer) {
                // Auto-move in Free Mode only if answer is correct and autoContinue is enabled
                correctAudio.onended = () => {
                    setTimeout(() => {
                        moveSentence(1);
                    }, 200);
                };
            } else {
                correctAudio.onended = null;
                wrongAudio.onended = null;
            }
        }

        function updateScore() {
            scoreDisplay.textContent = `${correctCount}/${sentences.length}`;
            scoreDisplay.style.display = 'block'; // Hiển thị score trong Test Mode
        }

        function showResults() {
            let resultText = `练习完成！\n正确答案数量：${correctCount}/${sentences.length}\n正确率：${((correctCount / sentences.length) * 100).toFixed(2)}%\n错误题目：`;
            wrongSentences.forEach(index => {
                resultText += `\n第${index + 1}题：\n你的选择：${userAnswers[index] || '未选择'}\n正确答案：${sentences[index].correctAnswer}\n`;
            });
            if (wrongSentences.size === 0) {
                resultText += '\n全部正确！';
            }
            resultsDisplay.textContent = resultText;
            resultsDisplay.style.display = 'block';
        }

        prevBtn.onclick = () => {
            moveSentence(-1);
        };

        nextBtn.onclick = () => {
            moveSentence(1);
        };

        replayBtn.onclick = () => {
            playCurrentSentence();
        };

        freeModeBtn.onclick = () => {
            isFreeMode = true;
            freeModeBtn.classList.add('active-mode');
            testModeBtn.classList.remove('active-mode');
            autoContinueBtn.disabled = false;
            autoContinueBtn.classList.remove('disabled');
            showHideBtn.disabled = false;
            showHideBtn.classList.remove('disabled');
            scoreDisplay.style.display = 'none';
            wrongSentencesDisplay.style.display = 'none';
            resultsDisplay.style.display = 'none';
            updateSentenceDisplay();
        };

        testModeBtn.onclick = () => {
            isFreeMode = false;
            testModeBtn.classList.add('active-mode');
            freeModeBtn.classList.remove('active-mode');
            autoContinueBtn.disabled = true;
            autoContinueBtn.classList.add('disabled');
            showHideBtn.disabled = true;
            showHideBtn.classList.add('disabled');
            showHideBtn.classList.remove('active-mode');
            showAnswer = false;
            scoreDisplay.style.display = 'block';
            currentIndex = 0;
            correctCount = 0;
            correctSentences.clear();
            wrongSentences.clear();
            userAnswers = [];
            for (let i = 0; i < sentences.length; i++) {
                wrongSentences.add(i);
            }
            updateSentenceDisplay();
        };

        autoContinueBtn.onclick = () => {
            if (isFreeMode) {
                autoContinue = !autoContinue;
                autoContinueBtn.classList.toggle('active-mode');
                if (!autoContinue) {
                    correctAudio.onended = null;
                }
            }
        };

        showHideBtn.onclick = () => {
            if (isFreeMode) {
                showAnswer = !showAnswer;
                showHideBtn.classList.toggle('active-mode');
                updateSentenceDisplay();
            }
        };

        sentenceNumber.onchange = () => {
            if (!isPlaying) {
                const num = parseInt(sentenceNumber.value) - 1;
                if (!isNaN(num) && num >= 0 && num < sentences.length) {
                    currentIndex = num;
                    updateSentenceDisplay();
                    playCurrentSentence();
                } else {
                    alert(`输入范围： 1 到 ${sentences.length}`);
                    updateSentenceDisplay();
                }
            }
        };

        sentenceNumber.onkeydown = (e) => {
            if (!isPlaying) {
                if (e.key === 'ArrowLeft') {
                    moveSentence(-1);
                }
                if (e.key === 'ArrowRight') {
                    moveSentence(1);
                }
            }
        };

        init();
    </script>
</body>
</html>